var xhr = null;
$(function() {
	// $(".bar-nav .back").on("click", function(){
	// 	history.back(-1);
	// });

	$(document).on("click", ".b-refresh", function(){
		location.href=document.location;
	});
	/*首页*/
    $(document).on("pageInit", "#page-index", function(e, pageId, page) {
		var bt = baidu.template;
		baidu.template.ESCAPE = false;
        var ifLoat = true,
        	pageNow = 1;
    	//团免券
    	if($(".popup-coupon").length>0 && !localStorage.freeCoupon){
    		$.popup('.popup-coupon');
    		localStorage.freeCoupon = true;
    	}
    	
    	//生成左右滑动页面
    	$(".index-page>.swiper-wrapper").html('');
    	$(".index-class .swiper-wrapper>a").each(function(index, el) {
    		var classId = $(el).attr("data-id");
    		var html = '<div class="swiper-slide" id="index_page_'+ (index+1) +'">';
    		if(classId == 0){
    			html += '<section class="swiper-container index-banner" data-space-between="0">'
		             +      '<div class="swiper-wrapper"></div>'
		             +      '<div class="swiper-pagination"></div>'
		             +  '</section>'
				     +  '<section class="index-index infinite-scroll infinite-scroll-bottom" data-distance="30">'
                     +      '<h2 class="index-pro-title"></h2>'
                     +      '<ul class="list-container"></ul>'
                     +      '<div class="infinite-scroll-preloader">'
                     +          '<div class="preloader"></div>'
                     +      '</div>'
                     +  '</section></div>';
    		}else{
    			html += '<section class="index-pro infinite-scroll infinite-scroll-bottom" data-distance="30">'
	                 +      '<ul class="list-container"></ul>'
	                 +      '<div class="infinite-scroll-preloader">'
	                 +          '<div class="preloader"></div>'
	                 +      '</div>'
	                 +  '</section></div>';
    		}
    		$(".index-page>.swiper-wrapper").append(html);
    	});
	    //页面左右滑动
	    var swiperIndexPage = new Swiper('.index-page', {
	        spaceBetween: 0,
	        touchMoveStopPropagation: false,
	        onSlideChangeStart:function(){
	        	$(".index-page").find('.infinite-scroll-preloader').show();
	        	$(".index-page").find('.infinite-scroll-bottom .list-container').html('');
	        },
	        onSlideChangeEnd: function(e){
	        	var index = swiperIndexPage.activeIndex + 1;
	        	swiperIndexClass.slideTo(index-1, 400, true);
	        	$(".index-class .swiper-wrapper>a").removeClass("active").eq(index-1).addClass("active");
	        	//容器发生改变,如果是js滚动，需要刷新滚动
            	$(".index-page").scroller('refresh');

            	var pageObj = $(".index-class .swiper-wrapper>a").eq(index-1);
            	var classId = pageObj.attr("data-id");
            	
            	ifLoad = true,
	        	pageNow = 1;
            	getData(index, classId);
	        }
	    });
    	//分类导航滑动
    	var swiperIndexClass = new Swiper('.index-class', {
	        spaceBetween: 0,
    		freeMode : true,
			slidesPerView : 'auto',
			onSlideChangeEnd: function(){
				var index = swiperIndexPage.activeIndex;
				swiperIndexPage.slideTo(index, 400, true);
			}
	    });
	    //点击分类导航页面左右滑动
	    $(".index-class .swiper-wrapper>a").on("click", function(){
	    	var index = $(".index-class .swiper-wrapper>a").index(this);
	    	swiperIndexPage.slideTo(index, 400, true);
	    });



        //预先加载
        getData(1, 0);

        // 注册'infinite'事件处理函数
        $(page).on('infinite', function() {
        	var pageIndex = $(".index-class a").index($(".index-class a.active"))+1,
        		classId = $(".index-class .swiper-wrapper>a.active").attr("data-id");

            // 如果正在加载，则退出
            if (!ifLoad) return;

            getData(pageIndex, classId);

        });

        function getData(index_page, classId){
        	$(".index-page>.swiper-wrapper>.swiper-slide-active .infinite-scroll-preloader").show();
        	$.ajax({
            	url: $(".index-page").attr("data-href"),
            	type: 'POST',
            	dataType: 'json',
            	data: {
            		id: classId,
            		page: pageNow
            	},
            	success: function(res){
					if(res.code>0){
						if(classId == 0){
	            			var bannerHtml=bt('tpl_indexBanner',res);
	            			$(".index-banner .swiper-wrapper").html(bannerHtml);
	            			swiperIndexBanner = new Swiper('.index-banner', {
						        spaceBetween: 0,
						        pagination: '.swiper-pagination',
						        observer: true
						    });
	            			var proHtml=bt('tpl_indexPro',res);
	            			$("#index_page_" + index_page).find('.infinite-scroll-bottom .list-container').append(proHtml);
	            		}else{
	            			var proHtml=bt('tpl_indexPro',res);
	            			$("#index_page_" + index_page).find('.infinite-scroll-bottom .list-container').append(proHtml);
	            		}

			            ifLoad = res["data"]["proData"]["ifLoad"];
	        			pageNow = res["data"]["proData"]["pageNow"] + 1;
					}else{
						if($("#errorTips").length<=0){
		    				$("#index_page_" + index_page).find('.infinite-scroll-bottom .list-container').append('<div id="errorTips">'+ res.msg +',请<span class="b-refresh">刷新</span>重试</div>');
		    			}else{
		    				$("#errorTips").html(res.msg +',请<span class="b-refresh">刷新</span>重试');
		    			}
					}
		            //容器发生改变,如果是js滚动，需要刷新滚动
		            $.refreshScroller();
					$(".index-page>.swiper-wrapper>.swiper-slide-active .infinite-scroll-preloader").hide();

            	}
            });
        }

    });


	/*详情页*/
    $(document).on("pageInit", "#page-deta", function(e, pageId, page) {
    	//产品banner
    	swiperDetaBanner = new Swiper('.deta-banner', {
	        spaceBetween: 0,
	        pagination: '.swiper-pagination',
	        observer: true
	    });

	    //倒计时
	    $(".deta-group .list li").each(function(index, el) {
	    	var time = parseInt($(el).find(".timer").attr("data-timer"));
	    	$(el).find(".timer span").html(timeToDate(time));
	    	var downTimer = setInterval(function(){
	    		--time;
	    		$(el).find(".timer span").html(timeToDate(time));
	    		if(time<=0){
	    			$(el).find(".timer").html('已结束');
	    			clearInterval(downTimer);
	    		}
	    	},1000);
	    });
    });


	/*团免列表*/
    $(document).on("pageInit", "#page-freeList", function(e, pageId, page) {
    	fn_pull(page);
    });


	/*选择拼团*/
    $(document).on("pageInit", "#page-proList", function(e, pageId, page) {
    	fn_pull(page);
    });


	/*拼团提示页*/
    $(document).on("pageInit", "#page-proTips", function(e, pageId, page) {
    	//倒计时
    	(function(){
    		var time = parseInt($("#downTime").attr("data-timer"));
	    	$("#downTime").html(timeToDate(time));
	    	var downTimer = setInterval(function(){
	    		--time;
	    		$("#downTime").html(timeToDate(time));
	    		if(time<=0){
	    			$("#downTime").parent().html('本团已结束');
	    			clearInterval(downTimer);
	    		}
	    	},1000);
    	})();
    });


	/*猜价格-商品列表*/
    $(document).on("pageInit", "#page-guessList", function(e, pageId, page) {
    	fn_pull(page, function(){
    		//倒计时
	    	$(".downTime").not(".ed").each(function(index, el) {
	    		var time = parseInt($(el).attr("data-timer"));
		    	$(el).html(timeToDate(time, true));
		    	$(el).addClass("ed");
		    	var downTimer = setInterval(function(){
		    		--time;
		    		$(el).html(timeToDate(time, true));
		    		if(time<=0){
		    			$(el).parent().html('已结束');
		    			clearInterval(downTimer);
		    		}
		    	},1000);
	    	});
    	});
    });


	/*猜价格-参与用户列表*/
    $(document).on("pageInit", "#page-guessJoinList", function(e, pageId, page) {
    	if($(".guessTab").length>0){
    		fn_click_tab();
    	}else{
    		fn_click();
    	}
    });


	/*猜价格-详情页*/
    $(document).on("pageInit", "#page-guessDeta", function(e, pageId, page) {
    	//弹窗
    	if($(".popup-guessCoupon").length>0){
    		$.popup('.popup-guessCoupon');
    	}

    	//产品banner
    	swiperDetaBanner = new Swiper('.deta-banner', {
	        spaceBetween: 0,
	        pagination: '.swiper-pagination',
	        observer: true
	    });

	    //倒计时
    	(function(){
    		var time = parseInt($("#downTime").attr("data-timer"));
	    	$("#downTime").html(timeToDate(time, 2));
	    	var downTimer = setInterval(function(){
	    		--time;
	    		$("#downTime").html(timeToDate(time, 2));
	    		if(time<=0){
	    			$("#downTime").html('已结束');
	    			clearInterval(downTimer);
	    		}
	    	},1000);
    	})();

    	//参与
    	$("#guess-join").on("click", function(){
    		$.popup('.popup-join');
    	});
    	//填写地址
    	$("#guess-address").on("click", function(){
    		$.popup('.popup-address');
    	});
    	if($("#city-picker").length>0){
    		$("#city-picker").cityPicker({
				toolbarTemplate: '<header class="bar bar-nav">\
								<button class="button button-link pull-right close-picker">确定</button>\
								<h1 class="title">选择收货地址</h1>\
								</header>'
			});
    	}
    });


	/*订单确认*/
    $(document).on("pageInit", "#page-orderCofirm", function(e, pageId, page) {
    	//数量增减
    	$(".quantity .minus").on("click", function(){
    		var num = parseInt($(this).next().val());
    		if(num>1){
    			$(this).next().val(--num);
    		}else{
    			return false;
    		}
    	});
    	$(".quantity .plus").on("click", function(){
    		var num = parseInt($(this).prev().val());
    		$(this).prev().val(++num)
    	});

    	//支付方式
    	$(".oc-pay li input").each(function(index, el) {
			if($(el).is(":checked")){
				$(el).parent().addClass("active");
			}
		});
    	$(".oc-pay input").on("change", function(){
    		$(this).parents(".oc-pay").find("li").removeClass("active");
    		$(this).parents(".oc-pay").find("input").each(function(index, el) {
    			if($(el).is(":checked")){
    				$(el).parent().addClass("active");
    			}
    		});
    	});
    });


	/*搜索*/
    $(document).on("pageInit", "#page-search", function(e, pageId, page) {
    	//清除文字
    	$(".bar-search .clearTxt").on("click", function(){
    		$(this).parents("form").find("input").val('');
    	});

    	//搜索历史
		writeHistory();
		$("#searchForm").on("submit",function(){
			if(!localStorage.search_history){
				localStorage.search_history = "";
			}
			var txt = $(".bar-search input").val();
			if(txt != ''){
				var history = localStorage.search_history.split("@#/");
				var ifAdd = true;
				for(var i = 0; i < history.length-1; i++){
					if(history[i] == txt){
						ifAdd = false;
					}
				}
				ifAdd ? localStorage.search_history += txt + "@#/" : "";
			}
			
		});
		// 清除记录
		$(".search-history a.del").on("click",function(){
			localStorage.search_history = "";
			writeHistory();
		});
		function writeHistory(){
			var historyHtml = "";
			var url = $(".search-history .list").attr("data-href");
			if(localStorage.search_history){
				var history = localStorage.search_history.split("@#/");
				for(var i = 0; i < history.length-1; i++){
					var txt = history[i];
					if(txt.length>7){
						txt = txt.substring(0,7);
						txt += '...';
					}
					historyHtml += "<a href='" + url + history[i] +"'>"+ txt +"</a>"
				}
				$(".search-history .list").html(historyHtml);
			}else{
				$(".search-history .list").html('<div class="tips-null">暂无搜索记录</div>');
			}
		}

		//加载
		if($(".pullbox").length>0){
			fn_pull(page);
		};
    });


	/*个人中心*/
    $(document).on("pageInit", "#page-user", function(e, pageId, page) {
    	
    });


	/*个人中心-收藏*/
    $(document).on("pageInit", "#page-collection", function(e, pageId, page) {
    	fn_pull(page);
    });


	/*个人中心-地址*/
    $(document).on("pageInit", "#page-address", function(e, pageId, page) {
    	fn_pull(page);

   //  	if($("#city-picker").length>0){
   //  		$("#city-picker").cityPicker({
			// 	toolbarTemplate: '<header class="bar bar-nav">\
			// 					<button class="button button-link pull-right close-picker">确定</button>\
			// 					<h1 class="title">选择收货地址</h1>\
			// 					</header>'
			// });
   //  	}
    });


	/*个人中心-猜价*/
    $(document).on("pageInit", "#page-guess", function(e, pageId, page) {
    	fn_pull_tab(page);
    });


	/*个人中心-优惠券*/
    $(document).on("pageInit", "#page-coupon", function(e, pageId, page) {
    	fn_pull_tab(page);
    });


	/*个人中心-订单列表*/
    $(document).on("pageInit", "#page-orderList", function(e, pageId, page) {
    	fn_pull_tab(page);
    });


	/*售后*/
    $(document).on("pageInit", "#page-afterSales", function(e, pageId, page) {
    	fn_pull_tab(page);

	    //图片预览
	    $(document).on("change", ".uploadImg input" ,function(){
    		var _this = $(this);

    		if(this.files.length == 0){
    			return false;
    		}else{
    			lrz(this.files[0], {width: 120})
		        .then(function (rst) {
		            if(_this.next().hasClass("noImg")){
		            	_this.next().removeClass("noImg");
		            	_this.next().html('<img src="'+ rst.base64 +'" />');
		            	if(_this.parents(".uploadImg").find(".uploadImg-item").length >= 3) return;
		            	_this.parent().after('<div class="uploadImg-item"><input type="file" capture="camera" accept="image/*" name="img[]" /><div class="img noImg"></div></div>');
		            }else{
		            	_this.next().find("img").attr("src", rst.base64);
		            }
		        })
		        .catch(function (err){
		            $.toast('图片选择失败,请重新选择');
		        })
    		}

    	});

    	//价格限制
    	$("#price").on("change", function(){
    		var max = parseFloat($(this).attr("data-max"));
    		var now = parseFloat($(this).val());
    		if(now>max){
    			$.toast('退款金额不能超过' + max);
    			$(this).val(max);
    		}
    	});
    });


	/*我的团*/
    $(document).on("pageInit", "#page-myGroup", function(e, pageId, page) {
    	fn_pull_tab(page);
    });



    $.init();
});


function timeToDate(_diff, type){
	var _hour = parseInt(_diff / 3600);
	_diff = _diff % 3600;
	var _minute = parseInt(_diff / 60);
	var _second = _diff % 60;
	_hour = (_hour < 10) ? "0"+_hour : _hour;
	_minute = (_minute < 10) ? "0"+_minute : _minute;
	_second = (_second < 10) ? "0"+_second : _second;
	if(type == 1){
		return '<span>' + _hour + '</span>:<span>' + _minute + '</span>:<span>' + _second + '</span>';
	}else if(type == 2){
		return '<span>' + _hour + '</span>时<span>' + _minute + '</span>分<span>' + _second + '</span>秒';
	}else{
		return _hour + ':' + _minute + ':' + _second;
	}
}


/*上拉加载函数*/
function fn_pull(page, fn){
	var bt = baidu.template;
	baidu.template.ESCAPE = false;
	var pageNow = 1,
		ifLoad = 1,
		url = $(".pullbox").attr("data-href");
	$(".pullbox").attr("data-pageNow", pageNow);
	getData(pageNow, url);

	// 注册'infinite'事件处理函数
    $(page).on('infinite', function() {
    	pageNow = $(".pullbox").attr("data-pageNow"),
		ifLoad = parseInt($(".pullbox").attr("data-ifLoad")),
		url = $(".pullbox").attr("data-href");

        // 如果正在加载，则退出
        if (!ifLoad) return;

        getData(pageNow, url);

    });

    function getData(pageNow, url){
    	$('.infinite-scroll-preloader').show();
    	$(".pullbox").attr("data-ifLoad",0);
    	$.ajax({
        	url: url,
        	type: 'POST',
        	dataType: 'json',
        	data: {
        		page: pageNow
        	},
        	success: function(res){

        		if(res.code>0){

				    var html=bt('tpl_pull',res);
				    $(".pullbox>.list-container").append(html);

			        ifLoad = res.data.ifLoad,
					pageNow = res.data.pageNow;
			    	$(".pullbox").attr("data-pageNow", pageNow+1);
					$(".pullbox").attr("data-ifLoad", ifLoad);
			        if (!ifLoad) {
			            // 加载完毕，则注销无限加载事件，以防不必要的加载
			            $.detachInfiniteScroll($('.infinite-scroll'));
			            // 删除加载提示符
			            $('.infinite-scroll-preloader').remove();
			        }

				    if(!!fn){
				    	fn();
				    }

        		}else{

        			if($("#errorTips").length<=0){
        				$(".pullbox>.list-container").append('<div id="errorTips">'+ res.msg +',请<span class="b-refresh">刷新</span>重试</div>');
        			}else{
        				$("#errorTips").html(res.msg +',请<span class="b-refresh">刷新</span>重试');
        			}
        			// 加载完毕，则注销无限加载事件，以防不必要的加载
		            $.detachInfiniteScroll($('.infinite-scroll'));
		            // 删除加载提示符
		            $('.infinite-scroll-preloader').remove();
        			
        		}

		        //容器发生改变,如果是js滚动，需要刷新滚动
		        $.refreshScroller();
		        $('.infinite-scroll-preloader').hide();

        	}
        });
    }
}


/*点击加载函数*/
function fn_click(fn){
	var bt = baidu.template;
	baidu.template.ESCAPE = false;
	var pageNow = 1,
		ifLoad = 1,
		url = $(".clickbox").attr("data-href");
	$(".clickbox").attr("data-pageNow", pageNow);
	getData(pageNow, url);

	// 注册'infinite'事件处理函数
    $(".clickbtn").on('click', function() {
    	pageNow = $(".clickbox").attr("data-pageNow"),
		ifLoad = parseInt($(".clickbox").attr("data-ifLoad")),
		url = $(".clickbox").attr("data-href");

        // 如果正在加载，则退出
        if (!ifLoad) return;

        getData(pageNow, url);

    });

    function getData(pageNow, url){
    	$('.infinite-scroll-preloader').show();
    	$(".clickbox").attr("data-ifLoad", 0);
    	$.ajax({
        	url: url,
        	type: 'POST',
        	dataType: 'json',
        	data: {
        		page: pageNow
        	},
        	success: function(res){

        		if(res.code>0){

        			var html=bt('tpl_click',res);
				    $(".clickbox>.list-container").append(html);
				    $('.infinite-scroll-preloader').hide();

			        ifLoad = res.data.ifLoad,
					pageNow = res.data.pageNow;
			    	$(".clickbox").attr("data-pageNow", pageNow+1);
					$(".clickbox").attr("data-ifLoad", ifLoad);

			        if (!ifLoad) {
			            $('.infinite-scroll-preloader,.clickbtn').remove();
			        }

				    if(!!fn){
				    	fn();
				    }

        		}else{

        			if($("#errorTips").length<=0){
        				$(".clickbox>.list-container").append('<div id="errorTips">'+ res.msg +',请<span class="b-refresh">刷新</span>重试</div>');
        			}else{
        				$("#errorTips").html(res.msg +',请<span class="b-refresh">刷新</span>重试');
        			}
        			$('.infinite-scroll-preloader,.clickbtn').remove();
        			
        		}

		        //容器发生改变,如果是js滚动，需要刷新滚动
		        $.refreshScroller();
		        $('.infinite-scroll-preloader').hide();
        	}
        });

    }
}

/*tab点击加载函数*/
function fn_click_tab(fn){
	var bt = baidu.template;
	baidu.template.ESCAPE = false;
	var pageNow = 1,
		ifLoad = 1,
		url = $(".guessTab").attr("data-href");
	$(".guessTab li").attr("data-pageNow", pageNow);

    $(".guessTab li").on('click', function() {
    	$(".guessTab li").removeClass("active");
    	$(this).addClass("active");
    	$(".clickbox>.list-container").html('');
    	$('.infinite-scroll-preloader').show();
    	var obj = $(".guessTab li.active");
    	pageNow = 1,
		ifLoad = 1,
		url = $(".guessTab").attr("data-href"),
		type = obj.attr("data-type");

        if(!!xhr){
        	xhr.abort();
        }

        getData(type, pageNow, url);
    });
	$(".guessTab li").eq(0).trigger("click");

    $(".clickbtn").on('click', function() {
    	var obj = $(".guessTab li.active");
    	pageNow = obj.attr("data-pageNow"),
		ifLoad = parseInt(obj.attr("data-ifLoad")),
		url = $(".guessTab").attr("data-href"),
		type = obj.attr("data-type");

        // 如果正在加载，则退出
        if (!ifLoad) return;

        // 设置flag
        loading = true;

        getData(type, pageNow, url);
    });

    function getData(type, pageNow, url){
    	$('.infinite-scroll-preloader').show();
    	$(".guessTab li.active").attr("data-ifLoad", 0);
    	xhr = $.ajax({
        	url: url,
        	type: 'POST',
        	dataType: 'json',
        	data: {
        		page: pageNow,
        		type: type
        	},
        	success: function(res){

        		if(res.code>0){
        			var html=bt('tpl_click',res);
				    $(".clickbox>.list-container").append(html);
				    $('.infinite-scroll-preloader').hide();

			        ifLoad = res.data.ifLoad,
					pageNow = res.data.pageNow;
			    	$(".guessTab li.active").attr("data-pageNow", pageNow+1);
					$(".guessTab li.active").attr("data-ifLoad", ifLoad);

			        if (!ifLoad) {
			            $('.infinite-scroll-preloader,.clickbtn').hide();
			        }

				    if(!!fn){
				    	fn();
				    }

        		}else{

        			if($("#errorTips").length<=0){
        				$(".clickbox>.list-container").append('<div id="errorTips">'+ res.msg +',请<span class="b-refresh">刷新</span>重试</div>');
        			}else{
        				$("#errorTips").html(res.msg +',请<span class="b-refresh">刷新</span>重试');
        			}
        			$('.infinite-scroll-preloader,.clickbtn').hide();
        		}
		        //容器发生改变,如果是js滚动，需要刷新滚动
		        $.refreshScroller();
		        $('.infinite-scroll-preloader').hide();
        	}
        });

	    
    }
}

/*tab上拉加载函数*/
function fn_pull_tab(page, fn){
	var bt = baidu.template;
	baidu.template.ESCAPE = false;
	var pageNow = 1,
		ifLoad = 1,
		url = $(".user-tab").attr("data-href");
	$(".user-tab li").attr("data-pageNow", pageNow);

    $(".user-tab li").on('click', function() {
    	$(".user-tab li").removeClass("active");
    	$(this).addClass("active");
    	$(".clickbox>.list-container").html('');
    	$('.infinite-scroll-preloader').show();
    	var obj = $(".user-tab li.active");
    	pageNow = 1,
		ifLoad = 1,
		url = $(".user-tab").attr("data-href"),
		type = obj.attr("data-type");

        if(!!xhr){
        	xhr.abort();
        }

        getData(type, pageNow, url);
    });
	$(".user-tab li").eq(0).trigger("click");

	// 注册'infinite'事件处理函数
    $(page).on('infinite', function() {
    	var obj = $(".user-tab li.active");
    	pageNow = obj.attr("data-pageNow"),
		ifLoad = parseInt(obj.attr("data-ifLoad")),
		url = $(".user-tab").attr("data-href"),
		type = obj.attr("data-type");

        // 如果正在加载，则退出
        if (!ifLoad) return;

        getData(type, pageNow, url);

    });

    function getData(type, pageNow, url){
    	$('.infinite-scroll-preloader').show();
    	$(".user-tab li.active").attr("data-ifLoad", 0);
    	xhr = $.ajax({
        	url: url,
        	type: 'POST',
        	dataType: 'json',
        	data: {
        		page: pageNow,
        		type: type
        	},
        	success: function(res){

        		if(res.code>0){

        			var html=bt('tpl_pull_tab',res);
				    $(".clickbox>.list-container").append(html);
				    $('.infinite-scroll-preloader').hide();
				    
			        ifLoad = res.data.ifLoad,
					pageNow = res.data.pageNow;
			    	$(".user-tab li.active").attr("data-pageNow", pageNow+1);
					$(".user-tab li.active").attr("data-ifLoad", ifLoad);

			        if (!ifLoad) {
			            $('.infinite-scroll-preloader,.clickbtn').hide();
			        }

				    if(!!fn){
				    	fn();
				    }

        		}else{

        			if($("#errorTips").length<=0){
        				$(".clickbox>.list-container").append('<div id="errorTips">'+ res.msg +',请<span class="b-refresh">刷新</span>重试</div>');
        			}else{
        				$("#errorTips").html(res.msg +',请<span class="b-refresh">刷新</span>重试');
        			}
			        $('.infinite-scroll-preloader,.clickbtn').hide();

        		}
		        //容器发生改变,如果是js滚动，需要刷新滚动
		        $.refreshScroller();
		        $('.infinite-scroll-preloader').hide();
	            
        	}
        });
	    
    }
}
